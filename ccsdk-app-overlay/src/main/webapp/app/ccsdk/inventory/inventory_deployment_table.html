<div id="page-content">

	<h1 class="heading-page" id="deployments-page">Deployments</h1>

	<!-- show progress indicator -->
	<div ng-show="ecdapp.isDataLoading">
		<div class="span" style="margin-bottom:20px;">
			<i class="icon-spinner small" role="img" aria-label="Please wait while the content loads"></i>
			Please wait while the content loads.
		</div>
	</div>

	<div ng-hide="ecdapp.isDataLoading">
		<div id="button-search-row">
			<div style="float:right;">
				<div class="group">
					<button tabindex="-1" class="btn btn-small" title="Reset Filters" type="button" ng-click="ecdapp.loadTable()"><i class="icon-arrows-replay-restart"></i></button>
					<input tabindex="0" class="btn btn-small" type="text" placeholder="Search Deployments" ng-model="ecdapp.searchBy"></input>
					<button tabindex="1" class="btn btn-small" type="button" ng-click="ecdapp.searchTable(ecdapp.searchBy)"><i class="ion-search"></i></button>
				</div>
			</div>
		</div>

		<div ng-show="ecdapp.isRequestFailed">
			<span class="ecd-error-message">{{ecdapp.errMsg}}</span>
		</div>

		<div ng-hide="ecdapp.isRequestFailed">
			<div
					b2b-table
					id="deployments-table"
					class="b2b-table-div"
					table-data="ecdapp.tableData"
					current-page="ecdapp.currentPageIgnored"
					next-sort="ecdapp.nextSortIgnored">
				<table>
					<thead b2b-table-row type="header">
					<tr id="th-header-row">
						<th b2b-table-header sortable="false" key="serviceId" ng-click="ecdapp.sortTable('serviceId')">Service ID/Deployment Ref.</th>
						<th b2b-table-header sortable="false" key="created" ng-click="ecdapp.sortTable('created')">Created</th>
						<th b2b-table-header sortable="false" key="updated" ng-click="ecdapp.sortTable('modified')">Modified</th>
						<th b2b-table-header sortable="false" key="tenant" style="background-color:#dbefef;">Tenant
								<button style="margin-bottom:-5px; box-shadow:0 0 0 0 rgba(0, 0, 0, 0.15); min-width:0;" tabindex="1" class="btn btn-small" title="Refresh Tenant and Status" type="button" ng-click="ecdapp.updateTable()">
								<i class="icon-arrows-replay-restart"></i>
								</button>
								<div ng-show="ecdapp.isSrvcDataLoading">
									<div class="span" style="margin-bottom:5px;">
							    		<i class="icon-spinner small" role="img" aria-label="Deployment Info is loading"></i>
							    		Tenant and Status Info loading
								    </div>
								</div>
						</th>
						<th b2b-table-header sortable="false" key="status" style="background-color:#dbefef;">Install Status</th>
						<th b2b-table-header sortable="false" style="background-color:#dbefef;">Actions</th>
					</tr>
					</thead>

					<tbody b2b-table-row type="body" row-repeat="rowData in ecdapp.tableData">
					<tr id="tr-rowData">
						<td b2b-table-body
							ng-bind="rowData.serviceId" 
							ng-class="{'td-error' : rowData.statusInfo === undefined}"/>
						<td b2b-table-body
							ng-bind="rowData.created | date : 'MM-dd-yyyy HH:mm:ss Z'"
							ng-class="{'td-error' : rowData.statusInfo === undefined}"/>
						<td b2b-table-body
							ng-bind="rowData.modified | date : 'MM-dd-yyyy HH:mm:ss Z'" 
							ng-class="{'td-error' : rowData.statusInfo === undefined}"/>
						<td b2b-table-body
							ng-bind="rowData.statusInfo.tenant_name"
							ng-class="{'td-error' : rowData.statusInfo === undefined}"/>
						<td b2b-table-body 
							ng-class="{'td-error' : rowData.statusInfo === undefined}">
							<img ng-src="{{rowData.statusInfo.statusImg}}" title="{{rowData.statusInfo.status}}" />
							</span>											
						</td>
						<td b2b-table-body ng-class="{'td-error' : rowData.statusInfo === undefined}">
							<div class="btn-group btn-actions" style="margin-bottom:0;box-shadow:none;">
									<button type="button" class="btn dropdown-toggle" data-toggle="dropdown" title="More Actions"><i class="icon-apps-marketplace"></i></button>									
										<ul class="dropdown-menu">
    										<li>
    											<div ng-click="ecdapp.viewBlueprintDataModal(rowData);">
													<i class="icon-documents-book ecd-icon-action"></i><a href="">View blueprint</a>
												</div>
											</li>
											<li>
												<div ng-click="ecdapp.viewDeploymentInputsModalPopup(rowData);">
													<i class="icoDocuments-report ecd-icon-action"></i><a href="">View Inputs</a>
												</div>
											</li>
											<li>
												<div ng-click="ecdapp.viewDeploymentExecutionsModalPopup(rowData);">
													<i class="icon-overview ecd-icon-action"></i><a href="">View executions</a>
												</div>
											</li>
											<li>
												<div ng-show="rowData.canDeploy && rowData.statusInfo.status === 'completed'" ng-click="ecdapp.updateDeploymentModalPopup(rowData);">
													<i class="icon-misc-pen ecd-icon-action"></i><a href="">Update deployment</a>
												</div>
											</li>
											<li>
												<div ng-show="rowData.canDeploy" ng-click="ecdapp.deleteDeploymentModalPopup(rowData);">
													<i class="icon-misc-trash ecd-icon-action"></i><a href="">Undeploy</a>
												</div>
											</li>
											<li>
												<div ng-show="rowData.statusInfo.is_helm && rowData.statusInfo.helm_status && rowData.statusInfo.status === 'completed'" ng-click="ecdapp.checkHelmStatus(rowData);">
													<i class="icoDocuments-report ecd-icon-action"></i><a href="">Helm Status</a>
												</div>
											</li>
											<li>
												<div ng-show="rowData.canDeploy && rowData.statusInfo.is_helm && rowData.statusInfo.status === 'completed'" ng-click="ecdapp.upgradeDeploymentModalPopup(rowData);">
													<i class="icon-controls-down ecd-icon-action"></i><a href="#">Helm upgrade deployment</a>
												</div>
											</li>
											<li>
												<div ng-show="rowData.canDeploy && rowData.statusInfo.is_helm && rowData.statusInfo.status === 'completed'" ng-click="ecdapp.rollbackDeploymentModalPopup(rowData);">
													<i class="icon-controls-up"></i><a href="#">Helm rollback deployment</a>
												</div>
											</li>
											<li>
												<div ng-show="rowData.canDeploy  && rowData.statusInfo === undefined" ng-click="ecdapp.deleteServiceModalPopup(rowData);">
													<i class="icon-misc-trash ecd-icon-action"></i><a href="">Delete Service</a>
												</div>		
											</li>
										</ul>
							</div><!-- .btn-group -->
						</td>
					</tr>
					</tbody>
				</table>
			</div>

			<div b2b-pagination="" total-pages="ecdapp.totalPages"
				 current-page="ecdapp.currentPageNum" click-handler="pageChangeHandler"
				 role="navigation">
			</div>

		</div>
	</div>

	<div style="height: 10px;">
		<!-- space between page number and black footer -->
	</div>

</div><!-- loading -->

</div><!-- page content -->
